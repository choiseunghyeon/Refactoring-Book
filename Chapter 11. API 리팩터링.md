## TIP

- 좋은 API는 데이터를 갱신하는 함수와 조회하는 함수를 명확히 구분한다. (명령 - 질의 분리 Command And Query)
- 참조 투명성 - 인풋이 같으면 아웃풋도 같은 함수.

## 리팩터링

- 질의 함수와 변경 함수 분리하기
  - 모듈과 함수는 소프트웨어를 구성하는 빌딩 블록이며, API는 이 블록들을 끼워 맞추는 연결부다.
  - get 함수 안에 set이 같이 있는 경우
- 함수 매개변수화하기

  - 함수의 로직이 비슷하고 단지 리터럴 값만 다르다면 다른 값만 매개변수로 받아 처리
  - 중복 없애기
  - Open–closed principle

- 플래그 인수 제거하기
  - 매개변수가 함수의 동작 모드를 전환하는 용도로만 쓰일 때
  - 플래그 인수가 불리언이라면 더욱 이해하기 어렵다.
- 객체 통째로 넘기기
  - 데이터 구조가 함수 사이를 건너 다니면서 필요 이상으로 분해될 때
  - 변화에 대응하기 쉽다 (필요한 데이터가 달라져도 매개변수는 달라지지 않는다. / 매개변수 목록이 짧아져 이해가 쉽다. / 중복된 로직을 없앨 수 있다.)
  - 함수가 레코드 자체에 의존하기를 원하지 않을 때는 수행하지 않는다. (특히 레코드와 함수가 서로 다른 모듈이라면)
  - 한 함수가 다른 모듈 객체의 값 몇 개로 무언가를 한다면? 그 객체로 옮겨줘야 하는게 나을 때도 있다. (기능 편애 악취)
  - 객체 전반으로 똑같은 값 몇개만 사용하고 있다면? 클래스 추출 (데이터 뭉치 악취)

### 무언가를 매개변수로 건네 피호출 함수가 판단할지 아니면 호출 함수가 정할지에 관해서는 답이 없기 때문에 균형점을 잡는다.

- 매개변수를 질의 함수로 바꾸기
  - 피호출 함수가 스스로 쉽게 결정할 수 있는 값이라면 매개변수로 받지 않아도 된다. (단, 대상 함수가 참조 투명 해야 한다. - 함수에 똑같은 값을 건네면 항상 똑같이 동작해야 한다.)
  - 매개변수를 없애는 대신 가변 전역 변수를 사용해서는 안된다.
- 질의 함수를 매개변수로 바꾸기

  - 함수 안에 두기엔 거북한 참조가 있을 때 (전역 변수, 제거하길 원하는 원소를 참조하는 경우)

- 세터 제거하기
  - 불변 유지
- 생성자를 팩터리 함수로 바꾸기
  - 새로운 객체를 만들어 반환할 때 일반적인 생성자의 능력만으로 부족할 때 (생성자는 해당 생성자를 정의한 클래스의 인스턴스만 반환한다. - 서브클래스의 인스턴스나 프락시를 반환할 수 없다.)

### 수많은 데이터를 받는 복잡한 함수를 잘게 쪼갠다.

- 함수를 명령으로 바꾸기

  - 명령 - 질의 원칙에서의 명령과는 다른 의미다 여기서 명령은 객체 안에 함수를 집어넣어 캡슐화한 명령 객체를 얘기한다.
  - 명령 객체를 사용하는 이유 - 일급 함수처럼 이용하고 싶을 때, 복잡한 연산을 잘게 쪼갤 때 (e.g 중첩 함수) / JS의 경우 일급 함수를 지원하고 중첩 함수를 사용할 수 있기 때문에 명령 객체는 하나의 대안일 뿐이다.

- 명령을 함수로 바꾸기

  - 명령 객체는 복잡한 연산을 다룰 수 있는 강력한 메커니즘을 제공하지만 로직이 복잡하지 않다면 함수로 바꿔주는게 낫다.

- 수정된 값 반환하기

  - 부수효과 없애기
  - 함수 안에서 데이터가 수정됐음을 확실히 알기 위해
  - 값 하나를 계산할 때 효과적 (여러 개를 갱신한다면 비효율적)

- 오류 코드를 예외로 바꾸기
- 예외를 사전 확인으로 바꾸기
  - 함수 수행 시 문제가 될 수 있는 조건을 함수 호출 전에 검사할 수 있다면, 예외를 던지는 대신 호출하는 곳에서 조건을 검사해야 한다.
